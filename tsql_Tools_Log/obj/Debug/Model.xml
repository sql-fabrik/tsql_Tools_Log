<?xml version="1.0" encoding="utf-8"?>
<DataSchemaModel FileFormatVersion="1.2" SchemaVersion="2.9" DspName="Microsoft.Data.Tools.Schema.Sql.Sql130DatabaseSchemaProvider" CollationLcid="1033" CollationCaseSensitive="False" xmlns="http://schemas.microsoft.com/sqlserver/dac/Serialization/2012/02">
	<Header>
		<CustomData Category="AnsiNulls">
			<Metadata Name="AnsiNulls" Value="True" />
		</CustomData>
		<CustomData Category="QuotedIdentifier">
			<Metadata Name="QuotedIdentifier" Value="True" />
		</CustomData>
		<CustomData Category="CompatibilityMode">
			<Metadata Name="CompatibilityMode" Value="130" />
		</CustomData>
		<CustomData Category="Reference" Type="SqlSchema">
			<Metadata Name="FileName" Value="C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\COMMON7\IDE\EXTENSIONS\MICROSOFT\SQLDB\EXTENSIONS\SQLSERVER\130\SQLSCHEMAS\MASTER.DACPAC" />
			<Metadata Name="LogicalName" Value="master.dacpac" />
			<Metadata Name="ExternalParts" Value="[master]" />
			<Metadata Name="SuppressMissingDependenciesErrors" Value="False" />
		</CustomData>
		<CustomData Category="Reference" Type="SqlSchema">
			<Metadata Name="FileName" Value="C:\PROGRAM FILES (X86)\MICROSOFT VISUAL STUDIO\2019\COMMUNITY\COMMON7\IDE\EXTENSIONS\MICROSOFT\SQLDB\EXTENSIONS\SQLSERVER\130\SQLSCHEMAS\MSDB.DACPAC" />
			<Metadata Name="LogicalName" Value="msdb.dacpac" />
			<Metadata Name="ExternalParts" Value="[msdb]" />
			<Metadata Name="SuppressMissingDependenciesErrors" Value="False" />
		</CustomData>
		<CustomData Category="Reference" Type="Assembly">
			<Metadata Name="LogicalName" Value="tsql_Tools_Log.dll" />
			<Metadata Name="FileName" Value="C:\PROJECTS\TSQL_TOOLS_LOG\TSQL_TOOLS_LOG\OBJ\DEBUG\TSQL_TOOLS_LOG.DLL" />
			<Metadata Name="AssemblyName" Value="tsql_Tools_Log" />
			<Metadata Name="PermissionSet" Value="SAFE" />
			<Metadata Name="Owner" Value="" />
			<Metadata Name="GenerateSqlClrDdl" Value="True" />
			<Metadata Name="IsVisible" Value="True" />
			<Metadata Name="IsModelAware" Value="True" />
			<Metadata Name="SkipCreationIfEmpty" Value="True" />
			<Metadata Name="AssemblySymbolsName" Value="C:\Projects\tsql_Tools_Log\tsql_Tools_Log\obj\Debug\tsql_Tools_Log.pdb" />
		</CustomData>
		<CustomData Category="SqlCmdVariables" Type="SqlCmdVariable" />
	</Header>
	<Model>
		<Element Type="SqlDatabaseOptions">
			<Property Name="Collation" Value="Latin1_General_CI_AS" />
			<Property Name="IsAnsiNullDefaultOn" Value="True" />
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Property Name="IsAnsiWarningsOn" Value="True" />
			<Property Name="IsArithAbortOn" Value="True" />
			<Property Name="IsConcatNullYieldsNullOn" Value="True" />
			<Property Name="IsTornPageProtectionOn" Value="False" />
			<Property Name="IsFullTextEnabled" Value="True" />
			<Property Name="PageVerifyMode" Value="3" />
			<Property Name="DefaultLanguage" Value="" />
			<Property Name="DefaultFullTextLanguage" Value="" />
			<Property Name="QueryStoreStaleQueryThreshold" Value="367" />
			<Relationship Name="DefaultFilegroup">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[PRIMARY]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlSchema" Name="[addInfrastructure]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_create_Environment]">
			<Property Name="BodyScript">
				<Value QuotedIdentifiers="False" AnsiNulls="False"><![CDATA[
BEGIN

Set NoCount ON;
	  
IF ( @keep_force = 'force_new')
BEGIN
print 'parameter: force_new'

-- delete prev.environment
IF EXISTS
 ( SELECT * 
   FROM   SSISDB.catalog.folders fo  
   join   SSISDB.catalog.environments en
   ON     fo.folder_id = en.folder_id
   WHERE  fo.name = @pSSIS_Folder_name 
     and  en.name = @pSSIS_Environment_name )
exec SSISDB.catalog.delete_environment @folder_name             = @pSSIS_Folder_name
                                     , @environment_name        = @pSSIS_Environment_name

-- create new environment
EXEC SSISDB.catalog.create_environment @environment_name        = @pSSIS_Environment_name
                                     , @environment_description = @pSSIS_Environment_description
                                     , @folder_name             = @pSSIS_Folder_name

-- provide config-Values 
Declare @idoc int
Exec sp_xml_preparedocument @idoc OUTPUT, @pXML_Environment_Config

Declare @tbl_Config_Values TABLE(
          ID               int Identity(1,1) primary key
        , [variable_name]  sysname    
        , [value]          sql_variant
        , [data_type]      sysname    
        )
-- here...
INSERT into @tbl_Config_Values
     ( [variable_name] , [value] , [data_type]  )
SELECT parameter_name  as 'variable_name'
     , configValue     as 'value'
	 , data_type       as 'data_type'
FROM   OpenXML( @idoc, 'allValues/keyValue', 1 )
WITH  ( parameter_name   sysname
      , data_type        sysname 
	  , configValue      sysname
	  )

Exec sp_xml_removedocument @idoc

-- min/ max WHILE 
Declare @min  int = ( select MIN(ID) from @tbl_Config_Values )
      , @max  int = ( select MAX(ID) from @tbl_Config_Values )

Declare @vVar_Name  sysname    
      , @vValue     sql_variant
      , @vData_Type sysname    

WHILE @min <= @max
BEGIN
    Set @vVar_Name   = ( select [variable_name] from @tbl_Config_Values where ID = @min )
	Set @vValue      = ( select [value]         from @tbl_Config_Values where ID = @min )
	Set @vData_Type  = ( select [data_type]     from @tbl_Config_Values where ID = @min )

    EXEC SSISDB.catalog.create_environment_variable @variable_name    = @vVar_Name
                                                  , @sensitive        = False     
                                                  , @description      = N'var.description'
                                                  , @environment_name = @pSSIS_Environment_name
                                                  , @folder_name      = @pSSIS_Folder_name
                                                  , @value            = @vValue    
                                                  , @data_type        = @vData_Type
    ----
    Set @min = @min + 1
END  -- end WHILE

END -- IF ( @keep_force = 'force_new')
--------------------------------------
IF ( @keep_force = 'keep_current' )
BEGIN
	print 'parameter: keep_current'
END

END -- end PROC]]></Value>
			</Property>
			<Property Name="IsQuotedIdentifierOn" Value="False" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[ID]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@keep_force]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@pSSIS_Environment_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@pSSIS_Environment_description]" />
				</Entry>
				<Entry />
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[sp_xml_preparedocument]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@pXML_Environment_Config]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[variable_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[value]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[data_type]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[sp_xml_removedocument]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[variable_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[value]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[data_type]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[ID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[variable_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[value]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sql_variant]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment].[@tbl_Config_Values].[data_type]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment].[@keep_force]">
						<Property Name="DefaultExpressionScript">
							<Value QuotedIdentifiers="False" AnsiNulls="False"><![CDATA['keep_current']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment].[@pSSIS_Environment_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment].[@pSSIS_Environment_description]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="200" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment].[@pXML_Environment_Config]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlXmlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[xml]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="3487" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROC [addInfrastructure].[usp_create_Environment]&#xD;&#xA;                               @keep_force                     sysname = 'keep_current'      -- [ keep_current | force_new ]&#xD;&#xA;                             , @pSSIS_Folder_name              sysname       &#xD;&#xA;                             , @pSSIS_Environment_name         sysname       &#xD;&#xA;                             , @pSSIS_Environment_description  nvarchar(200) &#xD;&#xA;                             , @pXML_Environment_Config        xml&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_create_Environment__custom]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

---- SSIS  create Environment
---- SSIS  Environment-Variables
IF EXISTS( 	SELECT *
			FROM   SSISDB.catalog.folders fo
			join   SSISDB.catalog.environments en
			ON     fo.folder_id = en.folder_id
			WHERE  en.name = 'env_Prod' )
EXEC [SSISDB].[catalog].[delete_environment] @environment_name=N'env_Prod', @folder_name=N'OXAION'
;

EXEC [SSISDB].[catalog].[create_environment] 
     @environment_name=N'env_Prod'
   , @environment_description=N''
   , @folder_name=N'OXAION'
;
----

DECLARE @varSourceDB    sql_variant = N'OXAION_Staging'
      , @varSourceSrv   sql_variant = N'BWTDESQL01\BI'
      , @varTargetDB    sql_variant = N'OXAION_Staging'
      , @varTargetSrv   sql_variant = N'BWTDESQL01\BI'
      , @varToolsDB     sql_variant = N'Tools_Log'
      , @varToolsSrv    sql_variant = N'BWTDESQL01\BI'


EXEC [SSISDB].[catalog].[create_environment_variable] 
     @variable_name=N'pSourceDB', @sensitive=False, @description=N''
   , @environment_name=N'env_Prod'
   , @folder_name=N'OXAION', @value=@varSourceDB, @data_type=N'String'
----
EXEC [SSISDB].[catalog].[create_environment_variable] 
     @variable_name=N'pSourceServername', @sensitive=False, @description=N''
   , @environment_name=N'env_Prod'
   , @folder_name=N'OXAION', @value=@varSourceSrv, @data_type=N'String'
----
EXEC [SSISDB].[catalog].[create_environment_variable] 
     @variable_name=N'pTargetDB', @sensitive=False, @description=N''
   , @environment_name=N'env_Prod'
   , @folder_name=N'OXAION', @value=@varTargetDB, @data_type=N'String'
----
EXEC [SSISDB].[catalog].[create_environment_variable] 
     @variable_name=N'pTargetServername', @sensitive=False, @description=N''
   , @environment_name=N'env_Prod'
   , @folder_name=N'OXAION', @value=@varTargetSrv, @data_type=N'String'
----
EXEC [SSISDB].[catalog].[create_environment_variable] 
     @variable_name=N'pToolsDB', @sensitive=False, @description=N''
   , @environment_name=N'env_Prod'
   , @folder_name=N'OXAION', @value=@varToolsDB, @data_type=N'String'
----
EXEC [SSISDB].[catalog].[create_environment_variable] 
     @variable_name=N'pToolsServername', @sensitive=False, @description=N''
   , @environment_name=N'env_Prod'
   , @folder_name=N'OXAION', @value=@varToolsSrv, @data_type=N'String'

END  -- end PROC]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sql_variant]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="4" />
				<Property Name="Length" Value="2394" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;CREATE PROC addInfrastructure.usp_create_Environment__custom&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_create_Environment_Reference]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
--  3 steps:
--  del_Environment_Reference
--  create_Environment_Reference
--  set_object_parameter_value


Declare @tbl_del_Environment_Reference TABLE( 
          ID               int Identity(1,1) primary key
        , reference_id     bigint
        , environment_name sysname
        )

Insert into @tbl_del_Environment_Reference
     ( reference_id, environment_name ) 
select er.reference_id
--   , fo.folder_id
--   , fo.name    as 'folder_name'
--   , pr.project_id
--   , pr.name    as 'project_name'
	 , er.environment_name
from   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
join   SSISDB.catalog.environment_references er
on     pr.project_id = er.project_id
where  fo.name             like @pSSIS_Folder_name
  and  pr.name             like @pSSIS_Project_name
  and  er.environment_name like @pEnvironment_name

-- min/ max WHILE 
Declare @min  int = ( select MIN(ID) from @tbl_del_Environment_Reference ) 
      , @max  int = ( select MAX(ID) from @tbl_del_Environment_Reference )
Declare @ref  int

WHILE @min <= @max
BEGIN
    Set @ref = ( select reference_id from @tbl_del_Environment_Reference where ID = @min )

    exec SSISDB.catalog.delete_environment_reference @reference_id = @ref 
    ----
    Set @min = @min + 1
END  -- end WHILE
---------------------------------------------------------------------	  

Declare @tbl_create_Environment_Reference TABLE( 
          ID               int Identity(1,1) primary key
        , folder_name      sysname
        , project_name     sysname
        )

Insert into @tbl_create_Environment_Reference
     ( folder_name, project_name )
select fo.name  as 'folder_name'
     , pr.name  as 'project_name'
from   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
where  fo.name  like @pSSIS_Folder_name
  and  pr.name  like @pSSIS_Project_name
order  by fo.name
     , pr.name

-- min/ max WHILE 
Set @min = ( select MIN(ID) from @tbl_create_Environment_Reference ) 
Set @max = ( select MAX(ID) from @tbl_create_Environment_Reference )
Declare @project_name sysname
      , @reference_id bigint

WHILE @min <= @max
BEGIN
    Set @project_name = ( select project_name from @tbl_create_Environment_Reference where ID = @min )

    EXEC SSISDB.catalog.create_environment_reference @environment_name   = @pEnvironment_name
                                                   , @folder_name        = @pSSIS_Folder_name
                                                   , @project_name       = @project_name  -- <<
                                                   , @reference_type     = R  -- Relative reference
                                                   , @reference_id       = @reference_id OUTPUT    
    ----
    Set @min = @min + 1
END  -- end WHILE
---------------------------------------------------------------------

Declare @tbl_set_object_parameter_value TABLE(
          ID                    int Identity(1,1) primary key
        , folder_name           sysname
        , project_name          sysname
        , package_name          sysname
        , parameter_name        sysname
        , environment_variable  sysname
        )

Insert into @tbl_set_object_parameter_value
     (   folder_name,   project_name,   package_name,   parameter_name,   environment_variable )
SELECT P.folder_name, P.project_name, P.package_name, P.parameter_name, E.environment_variable 
FROM ( select fo.name      as 'folder_name'
            , pr.name      as 'project_name'
       --   , op.object_type  -- = 30  fix
            , op.object_name  as 'package_name'
            , op.parameter_name
       from   SSISDB.catalog.folders fo
	   join   SSISDB.catalog.projects pr
	   on     fo.folder_id = pr.folder_id
       join   SSISDB.catalog.object_parameters op
       on     pr.project_id = op.project_id
       where  fo.name               like @pSSIS_Folder_name
         and  pr.name               like @pSSIS_Project_name
         and  op.parameter_name not like 'CM.%'
     ) P
join 
     (
       select en.environment_id
            , en.name    as 'environment_name'
            , ev.name    as 'environment_variable'
            , ev.value   as 'environment_value'
            , ev.type    as 'environment_variable_type'
       from   SSISDB.catalog.folders fo
	   join   SSISDB.catalog.environments en
	   on     fo.folder_id = en.folder_id
       join   SSISDB.catalog.environment_variables ev
       on     en.environment_id = ev.environment_id
       where  fo.name   like @pSSIS_Folder_name
	     and  en.name   like @pEnvironment_name
     ) E
ON     P.parameter_name = E.environment_variable
ORDER  by P.project_name, P.package_name, P.parameter_name

---- min/ max WHILE 
Set @min = ( select MIN(ID) from @tbl_set_object_parameter_value ) 
Set @max = ( select MAX(ID) from @tbl_set_object_parameter_value )

--      @project_name          sysname   >> already exists
Declare @package_name          sysname
      , @parameter_name        sysname
      , @environment_variable  sysname

WHILE @min <= @max
BEGIN
    Set @project_name         = ( select project_name         from @tbl_set_object_parameter_value where ID = @min )
    Set @package_name         = ( select package_name         from @tbl_set_object_parameter_value where ID = @min )
    Set @parameter_name       = ( select parameter_name       from @tbl_set_object_parameter_value where ID = @min )
    Set @environment_variable = ( select environment_variable from @tbl_set_object_parameter_value where ID = @min )


EXEC SSISDB.catalog.set_object_parameter_value @object_type     = 30  -- for package parameter
                                             , @folder_name     = @pSSIS_Folder_name
                                             , @project_name    = @project_name
                                             , @object_name     = @package_name
                                             , @parameter_name  = @parameter_name
                                             , @parameter_value = @environment_variable
                                             , @value_type      = R --!!
---- !! R to indicate that parameter_value is a referenced value and has been set to the name of an environment variable 
    ----
    Set @min = @min + 1
END  -- end WHILE

END -- end PROC]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[ID]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[reference_id]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[environment_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@pSSIS_Project_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@pEnvironment_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[reference_id]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[folder_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[project_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[ID]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[project_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[folder_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[project_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[package_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[parameter_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[environment_variable]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[ID]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[project_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[package_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[parameter_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[environment_variable]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[ID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[reference_id]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[bigint]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_del_Environment_Reference].[environment_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[ID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[folder_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_create_Environment_Reference].[project_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[ID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[folder_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[project_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[package_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[parameter_name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_Environment_Reference].[@tbl_set_object_parameter_value].[environment_variable]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment_Reference].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment_Reference].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_Environment_Reference].[@pEnvironment_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="6724" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROC [addInfrastructure].[usp_create_Environment_Reference]&#xD;&#xA;                               @pSSIS_Folder_name       sysname  &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; , @pSSIS_Project_name      sysname  &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; , @pEnvironment_name&#x9;&#x9;sysname  &#xD;&#xA;&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_create_SSIS_Folder]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Declare @Folder_id  bigint

IF NOT EXISTS( select folder_id 
               from   SSISDB.catalog.folders
			   where  name = @pSSIS_Folder_name )
BEGIN
    exec  SSISDB.catalog.create_folder @folder_name = @pSSIS_Folder_name

    exec  SSISDB.catalog.set_folder_description @folder_name        = @pSSIS_Folder_name
	                                          , @folder_description = @pSSIS_Folder_description 

END  -- end IF 

END  -- end PROC  ]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Folder].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Folder].[@pSSIS_Folder_description]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Folder].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Folder].[@pSSIS_Folder_description]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="674" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROC addInfrastructure.usp_create_SSIS_Folder&#xD;&#xA;                              @pSSIS_Folder_name         sysname       &#xD;&#xA;                            , @pSSIS_Folder_description  nvarchar(100) &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Set NoCount ON;

Declare @tempSteps TABLE( 
          ID  int                    identity(1,1)
        , job_Name                   sysname
        , step_Name                  sysname
        , Folder_Name                sysname NULL
        , Project_Name               sysname NULL
        , Environment_reference_id   bigint  NULL
        , Environment_reference_type sysname NULL
        , Package_Name               sysname NULL
        , step_nr                    int     
        , max_step_nr                int
        )

INSERT INTO @tempSteps
     (   job_Name
     ,   step_Name
     ,   Folder_Name
     ,   Project_Name
     ,   Environment_reference_id
     ,   Environment_reference_type
     ,   Package_Name
     ,   step_nr
     ,   max_step_nr 
     )
SELECT T.job_Name
     , T.step_Name
     , T.Folder_Name
     , T.Project_Name
     , T.Environment_reference_id
     , T.Environment_reference_type
     , T.Package_Name
     , ROW_NUMBER()  over (partition by T.job_Name order by T.step_Name) as 'step_nr'
     , COUNT(*)      over (partition by T.job_Name )                     as 'max_step_nr'
FROM  
(
select 'job_' + pr.name                    as 'job_Name' 
   --  , 'step100_start_Job'                 as 'step_Name'
     , LEFT(
        Replace( pr.name, 'proj', 'step' ) 
                                , 8 )
       + '_start_Job'                      as 'step_Name'
     , NULL                                as 'Folder_Name'
     , NULL                                as 'Project_Name'
     , NULL                                as 'Environment_reference_id'
     , NULL                                as 'Environment_reference_type'
     , NULL                                as 'Package_Name'
from   SSISDB.catalog.folders fo 
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
where  fo.name  like  @pSSIS_Folder_name
  and  pr.name  like  @pSSIS_Project_name  --'proj0100%'

UNION
select 'job_' + pr.name                    as 'job_Name' 
     , Replace( 
        Replace( pa.name, 'pack', 'step' )
                        , '.dtsx', ''    ) as 'step_Name'
     , fo.name                             as 'Folder_Name'
     , pr.name                             as 'Project_Name'
     , er.reference_id                     as 'Environment_reference_id'
     , er.reference_type                   as 'Environment_reference_type'
     , pa.name                             as 'Package_Name'
from   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
left   join
       SSISDB.catalog.environment_references er
on     pr.project_id = er.project_id
join   SSISDB.catalog.packages pa
on     pr.project_id = pa.project_id
where  fo.name  like  @pSSIS_Folder_name
  and  pr.name  like  @pSSIS_Project_name  --'proj0100%'
) T
ORDER  by T.job_Name, T.step_Name

----select * from @tempSteps
----------------------------
Declare @Servername                  sysname = @@SERVERNAME --// SERVERPROPERTY('ServerName') AS InstanceName
      , @job_Name_prev               sysname = ''  -- initial !!

      , @job_Name_new                sysname
      , @step_Name                   sysname
      , @Folder_Name                 sysname
      , @Project_Name                sysname
      ,	@Environment_reference_id    bigint 
      , @Environment_reference_type  sysname
      , @Package_Name                sysname
      , @step_nr                     int    
      , @max_step_nr                 int    

      , @step_action                 int    
      , @SSIS_cmd                    nvarchar(2000)
      , @Envi_cmd                    nvarchar(100) 

-- WHILE-Loop
Declare @min  int = ( select min(ID) from @tempSteps )
      , @max  int = ( select max(ID) from @tempSteps )

---- Object: Job ...
DECLARE @ReturnCode INT = 0
DECLARE @jobId      BINARY(16)

WHILE @min <= @max
BEGIN
    SET  @job_Name_new                = ( select job_Name                   from @tempSteps  where ID = @min )
    SET  @step_Name                   = ( select step_Name                  from @tempSteps  where ID = @min )
    SET  @Folder_Name                 = ( select Folder_Name                from @tempSteps  where ID = @min )
    SET  @Project_Name                = ( select Project_Name               from @tempSteps  where ID = @min )
    SET  @Environment_reference_id    = ( select Environment_reference_id   from @tempSteps  where ID = @min )
    SET  @Environment_reference_type  = ( select Environment_reference_type from @tempSteps  where ID = @min )
    SET  @Package_Name                = ( select Package_Name               from @tempSteps  where ID = @min )
    SET  @step_nr                     = ( select step_nr                    from @tempSteps  where ID = @min )
    SET  @max_step_nr                 = ( select max_step_nr                from @tempSteps  where ID = @min )

    IF ( @job_Name_prev <> @job_Name_new )
    BEGIN
        IF EXISTS( select * from msdb.dbo.sysjobs where name = @job_Name_new )
           EXEC msdb.dbo.sp_delete_job @job_name = @job_Name_new	    
        EXEC msdb.dbo.sp_add_job 
                      @job_name         = @job_Name_new
                    , @enabled          = 1
                    , @owner_login_name = N'sa'
                    , @job_id           = @jobId OUTPUT
    END  -- IF @pjob_Name_prev <> @pjob_Name_new
    --------------------------------------------
    IF ( @step_nr = 1 )
    BEGIN
        IF ( @step_nr < @max_step_nr )
           SET @step_action = 3  -- "Go to next step"
        ELSE
           SET @step_action = 1  -- (default)

        EXEC msdb.dbo.sp_add_jobstep 
                      @job_id            = @jobId
                    , @step_name         = @step_Name
                    , @step_id           = @step_nr
                    , @on_success_action = @step_action
                    , @on_fail_action    = 2  -- "Quit with failure (default)"
                    , @subsystem         = N'TSQL'
                    , @command           = N'SELECT ''start Job'' '
                    , @database_name     = N'tempdb'
    END  -- IF ( @pstep_nr = 1 )
    --------------------------------------------
    IF ( @step_nr > 1 )
    BEGIN
        IF ( @step_nr < @max_step_nr )
           SET @step_action = 3  -- "Go to next step"
        ELSE
           SET @step_action = 1  -- (default)
        --
        -- if environment is configured and referenced
        IF ( @Environment_reference_id is NULL )
           SET @Envi_cmd = N''
        ELSE
           SET @Envi_cmd = N' /ENVREFERENCE ' + CAST( @Environment_reference_id as nvarchar(20) ) + N'  '
        --
        SET @SSIS_cmd = N'/ISSERVER "\"\SSISDB\' + @pSSIS_Folder_name + '\' + @pSSIS_Project_name        +   '\' + @Package_Name           + '\""  /SERVER "\"' + @Servername + '\"" ' +  @Envi_cmd + ' /Par "\"$ServerOption::LOGGING_LEVEL(Int16)\"";1 /Par "\"$ServerOption::SYNCHRONIZED(Boolean)\"";True /CALLERINFO SQLAGENT /REPORTING E'
                    -- = N'/ISSERVER "\"\SSISDB\FBI_DataMigration\proj0100_Basic_configuration_import\pack0101_ApplicationSetting.dtsx\""  /SERVER localhost                         /Par "\"$ServerOption::LOGGING_LEVEL(Int16)\"";1 /Par "\"$ServerOption::SYNCHRONIZED(Boolean)\"";True /CALLERINFO SQLAGENT /REPORTING E'
        -- end IF   

        EXEC msdb.dbo.sp_add_jobstep 
                      @job_id            = @jobId
                    , @step_name         = @step_Name
                    , @step_id           = @step_nr
                    , @on_success_action = @step_action
                    , @subsystem         = N'SSIS'
                    , @command           = @SSIS_cmd
                    , @database_name     = N'master'
					, @flags             = 0
                    , @proxy_name        = @pSSIS_Proxy_Name
    END  -- IF ( @pstep_nr > 1 )
    --------------------------------------------
    IF ( @step_nr = @max_step_nr )
    BEGIN
        EXEC msdb.dbo.sp_update_job @job_id        = @jobId
		                          , @start_step_id = 1
        EXEC msdb.dbo.sp_add_jobserver @job_id      = @jobId
		                             , @server_name = @Servername
    END  -- IF ( @pstep_nr = @pmax_step_nr )

    --------------------------------------------
    --------------------------------------------
    SET @job_Name_prev = @job_Name_new
    SET @min = @min + 1

END  -- end WHILE 


END -- end PROC]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[ID]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[binary]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[job_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[step_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Folder_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Project_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Environment_reference_id]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Environment_reference_type]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Package_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[step_nr]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[max_step_nr]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@pSSIS_Project_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[job_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[step_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Folder_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Project_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Environment_reference_id]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Environment_reference_type]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Package_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[step_nr]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[max_step_nr]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_delete_job]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_delete_job].[@job_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@job_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@enabled]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@owner_login_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@step_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@step_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@on_success_action]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@on_fail_action]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@subsystem]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@command]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@database_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@flags]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@proxy_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@pSSIS_Proxy_Name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_update_job]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_update_job].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_update_job].[@start_step_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobserver]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobserver].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobserver].[@server_name]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[ID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[job_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[step_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Folder_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Project_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Environment_reference_id]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[bigint]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Environment_reference_type]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[Package_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[step_nr]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@tempSteps].[max_step_nr]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Job_with_proxy].[@pSSIS_Proxy_Name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="8837" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROC [addInfrastructure].[usp_create_SSIS_Job_with_proxy]&#xD;&#xA;                               @pSSIS_Folder_name    sysname&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; , @pSSIS_Project_name   sysname  &#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; , @pSSIS_Proxy_Name     sysname&#xD;&#xA;&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Set NoCount ON;

Declare @tempSteps TABLE( 
          ID  int                    identity(1,1)
        , job_Name                   sysname
        , step_Name                  sysname
        , Folder_Name                sysname NULL
        , Project_Name               sysname NULL
        , Environment_reference_id   bigint  NULL
        , Environment_reference_type sysname NULL
        , Package_Name               sysname NULL
        , step_nr                    int     
        , max_step_nr                int
        )

INSERT INTO @tempSteps
     (   job_Name
     ,   step_Name
     ,   Folder_Name
     ,   Project_Name
     ,   Environment_reference_id
     ,   Environment_reference_type
     ,   Package_Name
     ,   step_nr
     ,   max_step_nr 
     )
SELECT T.job_Name
     , T.step_Name
     , T.Folder_Name
     , T.Project_Name
     , T.Environment_reference_id
     , T.Environment_reference_type
     , T.Package_Name
     , ROW_NUMBER()  over (partition by T.job_Name order by T.step_Name) as 'step_nr'
     , COUNT(*)      over (partition by T.job_Name )                     as 'max_step_nr'
FROM  
(
select 'job_' + pr.name                    as 'job_Name' 
   --  , 'step100_start_Job'                 as 'step_Name'
     , LEFT(
        Replace( pr.name, 'proj', 'step' ) 
                                , 8 )
       + '_start_Job'                      as 'step_Name'
     , NULL                                as 'Folder_Name'
     , NULL                                as 'Project_Name'
     , NULL                                as 'Environment_reference_id'
     , NULL                                as 'Environment_reference_type'
     , NULL                                as 'Package_Name'
from   SSISDB.catalog.folders fo 
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
where  fo.name  like  @pSSIS_Folder_name
  and  pr.name  like  @pSSIS_Project_name  --'proj0100%'

UNION
select 'job_' + pr.name                    as 'job_Name' 
     , Replace( 
        Replace( pa.name, 'pack', 'step' )
                        , '.dtsx', ''    ) as 'step_Name'
     , fo.name                             as 'Folder_Name'
     , pr.name                             as 'Project_Name'
     , er.reference_id                     as 'Environment_reference_id'
     , er.reference_type                   as 'Environment_reference_type'
     , pa.name                             as 'Package_Name'
from   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
left   join
       SSISDB.catalog.environment_references er
on     pr.project_id = er.project_id
join   SSISDB.catalog.packages pa
on     pr.project_id = pa.project_id
where  fo.name  like  @pSSIS_Folder_name
  and  pr.name  like  @pSSIS_Project_name  --'proj0100%'
) T
ORDER  by T.job_Name, T.step_Name

----select * from @tempSteps
----------------------------
Declare @Servername                  sysname = @@SERVERNAME --// SERVERPROPERTY('ServerName') AS InstanceName
      , @job_Name_prev               sysname = ''  -- initial !!

      , @job_Name_new                sysname
      , @step_Name                   sysname
      , @Folder_Name                 sysname
      , @Project_Name                sysname
      ,	@Environment_reference_id    bigint 
      , @Environment_reference_type  sysname
      , @Package_Name                sysname
      , @step_nr                     int    
      , @max_step_nr                 int    

      , @step_action                 int    
      , @SSIS_cmd                    nvarchar(2000)
      , @Envi_cmd                    nvarchar(100) 

-- WHILE-Loop
Declare @min  int = ( select min(ID) from @tempSteps )
      , @max  int = ( select max(ID) from @tempSteps )

---- Object: Job ...
DECLARE @ReturnCode INT = 0
DECLARE @jobId      BINARY(16)

WHILE @min <= @max
BEGIN
    SET  @job_Name_new                = ( select job_Name                   from @tempSteps  where ID = @min )
    SET  @step_Name                   = ( select step_Name                  from @tempSteps  where ID = @min )
    SET  @Folder_Name                 = ( select Folder_Name                from @tempSteps  where ID = @min )
    SET  @Project_Name                = ( select Project_Name               from @tempSteps  where ID = @min )
    SET  @Environment_reference_id    = ( select Environment_reference_id   from @tempSteps  where ID = @min )
    SET  @Environment_reference_type  = ( select Environment_reference_type from @tempSteps  where ID = @min )
    SET  @Package_Name                = ( select Package_Name               from @tempSteps  where ID = @min )
    SET  @step_nr                     = ( select step_nr                    from @tempSteps  where ID = @min )
    SET  @max_step_nr                 = ( select max_step_nr                from @tempSteps  where ID = @min )

    IF ( @job_Name_prev <> @job_Name_new )
    BEGIN
        IF EXISTS( select * from msdb.dbo.sysjobs where name = @job_Name_new )
           EXEC msdb.dbo.sp_delete_job @job_name = @job_Name_new	    
        EXEC msdb.dbo.sp_add_job 
                      @job_name         = @job_Name_new
                    , @enabled          = 1
                    , @owner_login_name = N'sa'
                    , @job_id           = @jobId OUTPUT
    END  -- IF @pjob_Name_prev <> @pjob_Name_new
    --------------------------------------------
    IF ( @step_nr = 1 )
    BEGIN
        IF ( @step_nr < @max_step_nr )
           SET @step_action = 3  -- "Go to next step"
        ELSE
           SET @step_action = 1  -- (default)

        EXEC msdb.dbo.sp_add_jobstep 
                      @job_id            = @jobId
                    , @step_name         = @step_Name
                    , @step_id           = @step_nr
                    , @on_success_action = @step_action
                    , @on_fail_action    = 2  -- "Quit with failure (default)"
                    , @subsystem         = N'TSQL'
                    , @command           = N'SELECT ''start Job'' '
                    , @database_name     = N'tempdb'
    END  -- IF ( @pstep_nr = 1 )
    --------------------------------------------
    IF ( @step_nr > 1 )
    BEGIN
        IF ( @step_nr < @max_step_nr )
           SET @step_action = 3  -- "Go to next step"
        ELSE
           SET @step_action = 1  -- (default)
        --
        -- if environment is configured and referenced
        IF ( @Environment_reference_id is NULL )
           SET @Envi_cmd = N''
        ELSE
           SET @Envi_cmd = N' /ENVREFERENCE ' + CAST( @Environment_reference_id as nvarchar(20) ) + N'  '
        --
        SET @SSIS_cmd = N'/ISSERVER "\"\SSISDB\' + @pSSIS_Folder_name + '\' + @pSSIS_Project_name        +   '\' + @Package_Name           + '\""  /SERVER "\"' + @Servername + '\"" ' +  @Envi_cmd + ' /Par "\"$ServerOption::LOGGING_LEVEL(Int16)\"";1 /Par "\"$ServerOption::SYNCHRONIZED(Boolean)\"";True /CALLERINFO SQLAGENT /REPORTING E'
                    -- = N'/ISSERVER "\"\SSISDB\FBI_DataMigration\proj0100_Basic_configuration_import\pack0101_ApplicationSetting.dtsx\""  /SERVER localhost                         /Par "\"$ServerOption::LOGGING_LEVEL(Int16)\"";1 /Par "\"$ServerOption::SYNCHRONIZED(Boolean)\"";True /CALLERINFO SQLAGENT /REPORTING E'
        -- end IF   

        EXEC msdb.dbo.sp_add_jobstep 
                      @job_id            = @jobId
                    , @step_name         = @step_Name
                    , @step_id           = @step_nr
                    , @on_success_action = @step_action
                    , @subsystem         = N'SSIS'
                    , @command           = @SSIS_cmd
                    , @database_name     = N'master'
					, @flags             = 0

    END  -- IF ( @pstep_nr > 1 )
    --------------------------------------------
    IF ( @step_nr = @max_step_nr )
    BEGIN
        EXEC msdb.dbo.sp_update_job @job_id        = @jobId
		                          , @start_step_id = 1
        EXEC msdb.dbo.sp_add_jobserver @job_id      = @jobId
		                             , @server_name = @Servername
    END  -- IF ( @pstep_nr = @pmax_step_nr )

    --------------------------------------------
    --------------------------------------------
    SET @job_Name_prev = @job_Name_new
    SET @min = @min + 1

END  -- end WHILE 


END -- end PROC]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[ID]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[binary]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[job_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[step_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Folder_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Project_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Environment_reference_id]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Environment_reference_type]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Package_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[step_nr]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[max_step_nr]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@pSSIS_Project_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[job_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[step_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Folder_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Project_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Environment_reference_id]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Environment_reference_type]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Package_Name]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[step_nr]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[max_step_nr]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_delete_job]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_delete_job].[@job_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@job_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@enabled]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@owner_login_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_job].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@step_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@step_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@on_success_action]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@on_fail_action]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@subsystem]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@command]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@database_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobstep].[@flags]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_update_job]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_update_job].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_update_job].[@start_step_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobserver]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobserver].[@job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sp_add_jobserver].[@server_name]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[ID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[job_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[step_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Folder_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Project_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Environment_reference_id]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[bigint]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Environment_reference_type]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[Package_Name]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[step_nr]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@tempSteps].[max_step_nr]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="8739" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROC [addInfrastructure].[usp_create_SSIS_Job_with_SqlAgent]&#xD;&#xA;                               @pSSIS_Folder_name    sysname&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; , @pSSIS_Project_name   sysname  &#xD;&#xA;&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_deploy_SSIS_Project]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
----
-- refer "bulk-insert" Permissions

---- tech variables
Declare @sqlCmd   nvarchar(4000)    -- SQLcommand
      , @parDef   nvarchar(1000)    -- ParameterDefinition

---- return variables
DECLARE @ProjectBinary as varbinary(max)

---- internal sqlCommand variables
Set @parDef = N' @dsqlProjectBinary   varbinary(max) OUTPUT '

Set @sqlCmd = N'
Set @dsqlProjectBinary =
( SELECT * FROM OPENROWSET( BULK ''' + @pFile_Folder + @pFile_Name + '''
                          , SINGLE_BLOB ) as BinaryData )  '

exec sp_executesql @sqlCmd
                 , @parDef
				 , @dsqlProjectBinary = @ProjectBinary  OUTPUT
----	
	
Exec SSISDB.catalog.deploy_project @folder_name    = @pSSIS_Folder_name
                                 , @project_name   = @pSSIS_Project_name
								 , @project_stream = @ProjectBinary

END  -- end PROC ]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varbinary]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pFile_Folder]" />
				</Entry>
				<Entry>
					<References Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pFile_Name]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[sp_executesql]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pSSIS_Project_name]" />
				</Entry>
				<Entry />
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pFile_Folder]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="200" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pFile_Name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="200" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_deploy_SSIS_Project].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="1193" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROC addInfrastructure.usp_deploy_SSIS_Project&#xD;&#xA;                               @pFile_Folder        nvarchar(200) &#xD;&#xA;                             , @pFile_Name          nvarchar(200) &#xD;&#xA;                             , @pSSIS_Folder_name   sysname       &#xD;&#xA;                             , @pSSIS_Project_name  sysname&#x9;&#x9; &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_list_ProjectParameters_ALL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

select fo.name      as 'folder_name'
     , pr.name      as 'project_name'
--   , op.object_type  -- = 30  fix
     , op.object_name  as 'package_name'
     , op.parameter_name
	 , op.data_type
	 , op.design_default_value
from   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
join   SSISDB.catalog.object_parameters op
on     pr.project_id = op.project_id
where  fo.name           like @pSSIS_Folder_name
  and  pr.name           like @pSSIS_Project_name
  and  op.parameter_name not like 'CM%'
order  by folder_name
     , project_name
	 , package_name
     , parameter_name

END  -- end PROC ]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_list_ProjectParameters_ALL].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_list_ProjectParameters_ALL].[@pSSIS_Project_name]" />
				</Entry>
				<Entry />
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_list_ProjectParameters_ALL].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_list_ProjectParameters_ALL].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="870" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROC [addInfrastructure].[usp_list_ProjectParameters_ALL]&#xD;&#xA;                               @pSSIS_Folder_name   sysname    &#xD;&#xA;                             , @pSSIS_Project_name  sysname &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_list_ProjectParameters_DISTINCT]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

SELECT DISTINCT 
       op.parameter_name
	 , op.data_type
	 , op.design_default_value
FROM   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
ON     fo.folder_id = pr.folder_id
join   SSISDB.catalog.object_parameters op
ON     pr.project_id = op.project_id
WHERE  fo.name           like @pSSIS_Folder_name
  and  pr.name           like @pSSIS_Project_name
  and  op.parameter_name not like 'CM%'
ORDER  by parameter_name

END  -- end PROC ]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_list_ProjectParameters_DISTINCT].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_list_ProjectParameters_DISTINCT].[@pSSIS_Project_name]" />
				</Entry>
				<Entry />
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_list_ProjectParameters_DISTINCT].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_list_ProjectParameters_DISTINCT].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="676" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROC addInfrastructure.usp_list_ProjectParameters_DISTINCT&#xD;&#xA;                               @pSSIS_Folder_name   sysname      &#xD;&#xA;                             , @pSSIS_Project_name  sysname &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[addInfrastructure].[usp_list_ProjectParameters_XML]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

;
WITH parameterTable 
as
(
select DISTINCT 
       op.parameter_name
	 , op.data_type
	 , op.design_default_value
from   SSISDB.catalog.folders fo
join   SSISDB.catalog.projects pr
on     fo.folder_id = pr.folder_id
join   SSISDB.catalog.object_parameters op
on     pr.project_id = op.project_id
where  fo.name           like @pSSIS_Folder_name
  and  pr.name           like @pSSIS_Project_name
  and  op.parameter_name not like 'CM%'
)

SELECT parameter_name        as '@parameter_name'
     , data_type			 as '@data_type'
	 , design_default_value  as '@configValue'
FROM   parameterTable pt
FOR    XML PATH('keyValue'), ROOT('allValues')

END  -- end PROC]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[@pSSIS_Folder_name]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[@pSSIS_Project_name]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry />
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[CTE1].[parameterTable]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[CTE1].[parameterTable].[parameter_name]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[CTE1].[parameterTable].[data_type]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[CTE1].[parameterTable].[design_default_value]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[@pSSIS_Folder_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[addInfrastructure].[usp_list_ProjectParameters_XML].[@pSSIS_Project_name]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[addInfrastructure]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="912" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROC [addInfrastructure].[usp_list_ProjectParameters_XML]&#xD;&#xA;                                         @pSSIS_Folder_name   sysname      &#xD;&#xA;                                       , @pSSIS_Project_name  sysname &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlSchema" Name="[audit]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlDefaultConstraint" Name="[audit].[DF_audit_Row_Logging_created]">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[audit].[Row_Logging]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[audit].[Row_Logging].[created]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="12" />
		</Element>
		<Element Type="SqlDefaultConstraint" Name="[audit].[DF_audit_SSIS_Logging_created]">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[audit].[SSIS_Logging]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[audit].[SSIS_Logging].[created]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="13" />
		</Element>
		<Element Type="SqlDefaultConstraint" Name="[audit].[DF_SSIS_sendMail_Logging_created]">
			<Property Name="DefaultExpressionScript">
				<Value><![CDATA[(getdate())]]></Value>
			</Property>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForColumn">
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging].[created]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="14" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[audit].[PK_Row_Logging]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[audit].[Row_Logging].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[audit].[Row_Logging]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="15" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[audit].[PK_SSIS_Logging]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[audit].[SSIS_Logging].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[audit].[SSIS_Logging]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="16" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[audit].[PK_SSIS_sendMail_Logging]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[audit].[SSIS_sendMail_Logging].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="17" />
		</Element>
		<Element Type="SqlTable" Name="[audit].[Row_Logging]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[created]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="12" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[PackStartTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[PackageName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[TaskName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[vCurrRowsSource]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[vCurrRowsTarget]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[vInsDelta]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[vUpdDelta]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[Row_Logging].[vDelDelta]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="15" />
		</Element>
		<Element Type="SqlTable" Name="[audit].[SSIS_Logging]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[created]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="13" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[PackStartTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[SuccessCode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[PackageName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[TaskName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[UserName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_Logging].[MessageText]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="500" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="16" />
		</Element>
		<Element Type="SqlTable" Name="[audit].[SSIS_sendMail_Logging]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[created]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
						<AttachedAnnotation Disambiguator="14" />
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[PackStartTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[PackageName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[TaskName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[pEmail_to]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[audit].[SSIS_sendMail_Logging].[pEmail_attachment]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="17" />
		</Element>
		<Element Type="SqlProcedure" Name="[audit].[usp_End_Logging]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Set @pPackStartTime = CAST( @pPackStartTime as smalldatetime );

Declare @MessageText nvarchar(500);
Set     @MessageText = N',"vConfigSource":"'        + @vConfigSource                       + '"'
                     + N',"vConfigPackagename":"'   + @vConfigPackagename                  + '"'
					 + N',"vConfigValue":"'         + CAST(@vConfigValue as nvarchar(10))  + '"'
				     + N'}'


-- specific "end-message"
IF ( @pPackageName = N'pack01_' and @pTaskName = N'SQL_end_Logging_error1' )
   SET @MessageText  = N'{ "Packagestatus":"irgend ein Fehler / Package ist beendet"' + @MessageText

IF ( @pPackageName = N'pack01_' and @pTaskName = N'SQL_end_Logging__OK' )
   Set @MessageText  = N'{ "Packagestatus":"Package ist beendet"' + @MessageText
---------

IF ( @pPackageName = N'pack00__template_from_BIML' and @pTaskName = N'SQL_end_Logging_error1' )
   Set @MessageText  = N'{ "Packagestatus":"T-SQL MERGE hat einen Fehler verursacht! / Package ist beendet"' + @MessageText

IF ( @pPackageName = N'pack00__template_from_BIML' and @pTaskName = N'SQL_end_Logging__OK' )
   Set @MessageText  = N'{ "Packagestatus":"Package ist beendet"' + @MessageText

-- default "end-messaage"
IF LEFT(@MessageText, 7) <> '{ "Pack'
   Set @MessageText  = N'{ "Packagestatus":"Package ist beendet"' + @MessageText
---------------------------------------------------------------------------------------

 
INSERT INTO [audit].[SSIS_Logging]
	   (   PackStartTime,   SuccessCode,   PackageName,   TaskName,   UserName,  MessageText )
VALUES ( @pPackStartTime, @vSuccessCode, @pPackageName, @pTaskName, @pUserName, @MessageText )

END  --  end Proc]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@pPackStartTime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@vConfigSource]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@vConfigPackagename]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@vConfigValue]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@pPackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@pTaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[SuccessCode]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[MessageText]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@vSuccessCode]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_End_Logging].[@pUserName]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@pPackageName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@pTaskName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@pUserName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@pPackStartTime]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@vSuccessCode]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@vConfigSource]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@vConfigPackagename]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_End_Logging].[@vConfigValue]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2216" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROC [audit].[usp_End_Logging]&#xD;&#xA;                   @pPackageName       nvarchar(100) --  = ?&#xD;&#xA;                 , @pTaskName          nvarchar(100) --  = ?&#xD;&#xA;                 , @pUserName          nvarchar(100) --  = ?&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; , @pPackStartTime     datetime      --  = ?&#xD;&#xA;                 , @vSuccessCode       int           --  = ?&#xD;&#xA;                 , @vConfigSource      nvarchar(100) --  = ?  &#xD;&#xA;                 , @vConfigPackagename nvarchar(100) --  = ?    &#xD;&#xA;                 , @vConfigValue       int           --  = ?   &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[audit].[usp_Row_Logging]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Set @pPackStartTime = CAST( @pPackStartTime as smalldatetime );

INSERT INTO [audit].[Row_Logging]
	   (   PackStartTime,   PackageName,   TaskName,  vCurrRowsSource,  vCurrRowsTarget,  vInsDelta,  vUpdDelta,  vDelDelta )
VALUES ( @pPackStartTime, @pPackageName, @pTaskName, @vCurrRowsSource, @vCurrRowsTarget, @vInsDelta, @vUpdDelta, @vDelDelta )

END  --  end Proc]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@pPackStartTime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vCurrRowsSource]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vCurrRowsTarget]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vInsDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vUpdDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vDelDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@pPackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@pTaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@vCurrRowsSource]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@vCurrRowsTarget]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@vInsDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@vUpdDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Row_Logging].[@vDelDelta]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@pPackStartTime]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@pPackageName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@pTaskName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@vCurrRowsSource]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@vCurrRowsTarget]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@vInsDelta]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@vUpdDelta]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Row_Logging].[@vDelDelta]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="908" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROC [audit].[usp_Row_Logging]&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;   @pPackStartTime     datetime      --  = ?&#xD;&#xA;                 , @pPackageName       nvarchar(100) --  = ?&#xD;&#xA;                 , @pTaskName          nvarchar(100) --  = ?&#xD;&#xA;                 , @vCurrRowsSource    bigint        --  = ?&#xD;&#xA;                 , @vCurrRowsTarget    bigint        --  = ?&#xD;&#xA;                 , @vInsDelta          bigint        --  = ?&#xD;&#xA;                 , @vUpdDelta          bigint        --  = ?&#xD;&#xA;                 , @vDelDelta          bigint        --  = ?&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[audit].[usp_SSIS_sendMail_Logging]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Set @pPackStartTime = CAST( @pPackStartTime as smalldatetime );

INSERT INTO [audit].[SSIS_sendMail_Logging]
	   (   PackStartTime,   PackageName,   TaskName,  pEmail_to,  pEmail_attachment )
VALUES ( @pPackStartTime, @pPackageName, @pTaskName, @pEmail_to, @pEmail_attachment )

END  --  end Proc]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[audit].[usp_SSIS_sendMail_Logging].[@pPackStartTime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging].[pEmail_to]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_sendMail_Logging].[pEmail_attachment]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_SSIS_sendMail_Logging].[@pPackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_SSIS_sendMail_Logging].[@pTaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_SSIS_sendMail_Logging].[@pEmail_to]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_SSIS_sendMail_Logging].[@pEmail_attachment]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_SSIS_sendMail_Logging].[@pPackageName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_SSIS_sendMail_Logging].[@pTaskName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_SSIS_sendMail_Logging].[@pPackStartTime]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_SSIS_sendMail_Logging].[@pEmail_to]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_SSIS_sendMail_Logging].[@pEmail_attachment]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="626" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROC [audit].[usp_SSIS_sendMail_Logging]&#xD;&#xA;                   @pPackageName        nvarchar(100) --  = ?&#xD;&#xA;                 , @pTaskName           nvarchar(100) --  = ?&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; , @pPackStartTime      datetime &#xD;&#xA;                 , @pEmail_to           nvarchar(50)&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; , @pEmail_attachment   nvarchar(max)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[audit].[usp_Start_Logging]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

Set @pPackStartTime = CAST( @pPackStartTime as smalldatetime );

Declare @MessageText nvarchar(500)

Set @MessageText = N'{'
                 + N' "Packagestatus":"Package ist gestartet"'
				 + N' }'
----
 
INSERT INTO [audit].[SSIS_Logging]
	   (   PackStartTime,   SuccessCode,   PackageName,   TaskName,   UserName,  MessageText )
VALUES ( @pPackStartTime, @pSuccessCode, @pPackageName, @pTaskName, @pUserName, @MessageText )

END  --  end Proc]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Start_Logging].[@pPackStartTime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[SuccessCode]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[UserName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[MessageText]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Start_Logging].[@pSuccessCode]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Start_Logging].[@pPackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Start_Logging].[@pTaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[usp_Start_Logging].[@pUserName]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Start_Logging].[@pPackageName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Start_Logging].[@pTaskName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Start_Logging].[@pUserName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Start_Logging].[@pPackStartTime]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[audit].[usp_Start_Logging].[@pSuccessCode]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="6" />
				<Property Name="Length" Value="819" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;CREATE PROC [audit].[usp_Start_Logging]&#xD;&#xA;                   @pPackageName       nvarchar(100) --  = ?&#xD;&#xA;                 , @pTaskName          nvarchar(100) --  = ?&#xD;&#xA;                 , @pUserName          nvarchar(100) --  = ?&#xD;&#xA;&#x9;&#x9;&#x9;&#x9; , @pPackStartTime     datetime      --  = ?&#xD;&#xA;                 , @pSuccessCode       int           --  = ?&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[audit].[vw_JobHistory]">
			<Property Name="QueryScript">
				<Value><![CDATA[ 

select 
J.name as 'Jobname'
, H.*
from msdb.dbo.sysjobs J
JOIN msdb.dbo.sysjobhistory H
ON J.job_id = H.job_id
where J.name like 'job_proj%'
and H.run_status <> 1

-- end view]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[Jobname]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs].[name]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[instance_id]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[instance_id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[job_id]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[job_id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[step_id]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[step_id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[step_name]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[step_name]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[sql_message_id]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[sql_message_id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[sql_severity]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[sql_severity]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[message]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[message]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[run_status]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[run_status]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[run_date]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[run_date]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[run_time]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[run_time]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[run_duration]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[run_duration]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[operator_id_emailed]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[operator_id_emailed]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[operator_id_netsent]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[operator_id_netsent]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[operator_id_paged]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[operator_id_paged]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[retries_attempted]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[retries_attempted]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_JobHistory].[server]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[server]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs].[job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[job_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobs].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[sysjobhistory].[run_status]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="64" />
				<Property Name="Length" Value="288" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="/****** Script for SelectTopNRows command from SSMS  ******/&#xD;&#xA;&#xD;&#xA;create view audit.vw_JobHistory&#xD;&#xA;as" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[audit].[vw_Row_Logging]">
			<Property Name="QueryScript">
				<Value><![CDATA[

with JoinTbl as(
select 'SL' as 'source', PackStartTime, PackageName, created 
from   audit.SSIS_Logging
union
select 'RL' as 'source', PackStartTime, PackageName, created 
from   audit.Row_Logging
--Order  by PackStartTime, PackageName, created
)
SELECT ROW_NUMBER() Over(Order by JT.created, JT.PackStartTime, JT.PackageName)  as 'RowNr'
     , JT.PackStartTime
    -- , JT.PackageName
     , CASE
          WHEN LAG( JT.PackageName, 1 ) Over( Order by JT.created ) IS NULL           THEN  JT.PackageName  -- very 1st row
          WHEN JT.PackageName = LAG( JT.PackageName, 1 ) Over( Order by JT.created )  THEN  NULL
          ELSE                                                                              JT.PackageName
       END                                                                       as 'PackageName'
     , JT.created
     , CASE
          WHEN COALESCE( SL.TaskName, RL.TaskName ) =    'SQL_log_RowCount'    THEN RL.TaskName
          WHEN COALESCE( SL.TaskName, RL.TaskName ) like 'SQL_log_RowCount_%'  THEN Replace(RL.TaskName, 'SQL_log_RowCount_', 'rowCnt_')   -- SQL_log_RowCount_FixingDetail  rowCnt_
          ELSE COALESCE( SL.TaskName, RL.TaskName )
       END                                                                        as 'TaskName'
    -- , COALESCE( SL.TaskName, RL.TaskName ) as 'TaskName'
     , RL.vCurrRowsSource
     , RL.vCurrRowsTarget
     , RL.vInsDelta
     , RL.vUpdDelta
     , RL.vDelDelta
FROM   audit.SSIS_Logging SL
full   join   
       JoinTbl JT
ON     SL.PackStartTime = JT.PackStartTime
  and  SL.PackageName   = JT.PackageName
  and  SL.created       = JT.created 
full   join
       audit.Row_Logging RL
ON     JT.PackStartTime = RL.PackStartTime
  and  JT.PackageName   = RL.PackageName
  and  JT.created       = RL.created
-- end VIEW]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[RowNr]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[PackStartTime]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[created]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[SSIS_Logging].[created]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[vCurrRowsSource]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[Row_Logging].[vCurrRowsSource]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[vCurrRowsTarget]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[Row_Logging].[vCurrRowsTarget]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[vInsDelta]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[Row_Logging].[vInsDelta]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[vUpdDelta]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[Row_Logging].[vUpdDelta]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[vDelDelta]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[Row_Logging].[vDelDelta]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[audit].[vw_Row_Logging].[CTE1].[JoinTbl]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[CTE1].[JoinTbl].[source]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[CTE1].[JoinTbl].[PackStartTime]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[CTE1].[JoinTbl].[PackageName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[PackageName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_Row_Logging].[CTE1].[JoinTbl].[created]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[created]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[audit].[SSIS_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vCurrRowsSource]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vCurrRowsTarget]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vInsDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vUpdDelta]" />
				</Entry>
				<Entry>
					<References Name="[audit].[Row_Logging].[vDelDelta]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="4" />
				<Property Name="Length" Value="1892" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;CREATE VIEW audit.vw_Row_Logging&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[audit].[vw_SSIS_Logging]">
			<Property Name="QueryScript">
				<Value><![CDATA[

With tblStart as (
select ID             as 'ID_Start'
     , created        as 'created_Start'
	 , PackStartTime
	 , PackageName
	 , TaskName       as 'Task_Start'
from   audit.SSIS_Logging 
where  TaskName like 'SQL_start_Logging'
),
     tblEnd as(
select ID             as 'ID_End'
     , created        as 'created_End'
	 , PackStartTime
	 , PackageName
	 , TaskName       as 'Task_End'
from   audit.SSIS_Logging
where  TaskName like 'SQL_end%'
)
SELECT TS.ID_Start
     , TE.ID_End
	 , (TE.ID_End - TS.ID_Start)  as 'ID_delta'
	 , TS.created_Start
	 , TE.created_End
	 , CASE  
	      WHEN DATEDIFF( second, TS.created_Start, TE.created_End ) < 0  THEN NULL
		  WHEN DATEDIFF( second, TS.created_Start, TE.created_End ) = 0  THEN 1
		  ELSE DATEDIFF( second, TS.created_Start, TE.created_End )
       END                                                    as 'duration_Second'
	 , TS.PackStartTime
	 , TS.PackageName
	 , TS.Task_Start
     , TE.Task_End
FROM   tblStart TS
join   tblEnd   TE
ON     TS.PackStartTime = TE.PackStartTime
  and  TS.PackageName   = TE.PackageName
WHERE  TE.ID_End > TS.ID_Start
--  end VIEW]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[ID_Start]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[ID_End]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[ID_delta]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[created_Start]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[created_End]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[duration_Second]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[PackStartTime]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[PackageName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[audit].[SSIS_Logging].[PackageName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[Task_Start]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[Task_End]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblStart]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblStart].[ID_Start]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[ID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblStart].[created_Start]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[created]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblStart].[PackStartTime]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblStart].[PackageName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[PackageName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblStart].[Task_Start]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[TaskName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblEnd]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblEnd].[ID_End]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[ID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblEnd].[created_End]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[created]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblEnd].[PackStartTime]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblEnd].[PackageName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[PackageName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[audit].[vw_SSIS_Logging].[CTE1].[tblEnd].[Task_End]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[audit].[SSIS_Logging].[TaskName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[audit].[SSIS_Logging]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[ID]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[created]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackStartTime]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[PackageName]" />
				</Entry>
				<Entry>
					<References Name="[audit].[SSIS_Logging].[TaskName]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[audit]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1207" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE VIEW [audit].[vw_SSIS_Logging]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[dbo].[Database_LoginUser_Mapping]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[ID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[create_date]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[smalldatetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[Servername]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[Servicename]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[Login_name]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[Login_type]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[Login_sid]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[DatabaseName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[User_name]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[User_type]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[dbo].[Database_LoginUser_Mapping].[User_sid]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varbinary]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="18" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[dbo].[PK_Database_LoginUser_Mapping]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[ID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="18" />
		</Element>
		<Element Type="SqlProcedure" Name="[dbo].[usp_TSQL_get_Database_LoginUser_Mapping]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

SET NoCount ON;

TRUNCATE TABLE dbo.Database_LoginUser_Mapping;
----

DECLARE @parTable TABLE (
          rowNr         int
		, DatabaseName  sysname
		)

INSERT INTO @parTable
SELECT ROW_NUMBER() over(Order by database_id) as 'rowNr'
     , name as 'DatabaseName'
FROM   sys.databases
WHERE  state_desc = 'ONLINE'

----
DECLARE @min  int = ( SELECT min(rowNr) FROM @parTable )
      , @max  int = ( SELECT max(rowNr) FROM @parTable )

DECLARE @pDatabaseName  sysname  
DECLARE @sqlCmd         nvarchar(4000)

WHILE @min <= @max
BEGIN

	SET @pDatabaseName = ( SELECT DatabaseName FROM @parTable WHERE rowNr = @min )

	SET @sqlCmd = N'
	;
	WITH 
	LoginTbl as
	(
	SELECT @@SERVERNAME   as ''Servername''
		 , @@SERVICENAME  as ''Servicename''
		 , sp.name        as ''Login_name''
		 , sp.type_desc   as ''Login_type''
		 , sp.sid         as ''Login_sid''
	FROM   sys.server_principals sp
	WHERE  type not in (''R'')
	) , 
	User_Tbl as
	(
	SELECT ''' + @pDatabaseName + '''  as ''DatabaseName''
		 , dp.name        as ''User_name''
		 , dp.type_desc   as ''User_type''
		 , dp.sid         as ''User_sid''
	FROM  ' + @pDatabaseName + '.sys.database_principals dp
	WHERE  dp.is_fixed_role = 0
	)
	INSERT INTO dbo.Database_LoginUser_Mapping
		 ( create_date, Servername
		 , Servicename, Login_name, Login_type, Login_sid
		 , DatabaseName, User_name, User_type, User_sid )
	SELECT CAST( GETDATE() as smalldatetime )  as ''create_date''
		 , LT.Servername
		 , LT.Servicename
		 , LT.Login_name
		 , LT.Login_type
		 , LT.Login_sid
		 , UT.DatabaseName
		 , UT.User_name
		 , UT.User_type
		 , UT.User_sid
	FROM   LoginTbl LT
	FULL   JOIN
		   User_Tbl UT
	ON     LT.Login_sid = UT.User_sid '-- end sqlCmd

	EXEC sp_executesql @sqlCmd

	----
	SET @min = @min + 1

END  -- end WHILE

END  -- end PROC]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[usp_TSQL_get_Database_LoginUser_Mapping].[@parTable].[rowNr]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[nvarchar]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[database_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[state_desc]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[usp_TSQL_get_Database_LoginUser_Mapping].[@parTable].[DatabaseName]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[sp_executesql]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[dbo].[usp_TSQL_get_Database_LoginUser_Mapping].[@parTable]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[usp_TSQL_get_Database_LoginUser_Mapping].[@parTable].[rowNr]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[dbo].[usp_TSQL_get_Database_LoginUser_Mapping].[@parTable].[DatabaseName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[sys].[sysname]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="8" />
				<Property Name="Length" Value="1951" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="----&#xD;&#xA;&#xD;&#xA;CREATE PROC dbo.[usp_TSQL_get_Database_LoginUser_Mapping] &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[dbo].[vw_Database_FileSize]">
			<Property Name="QueryScript">
				<Value><![CDATA[
SELECT @@SERVERNAME   as 'Servername'
     , @@SERVICENAME  as 'Servicename'
     , db.name        as 'DatabaseName'
	 , db.recovery_model_desc --
	 , db.database_id
     , mf.type_desc
	 , mf.size        as 'size_inPages'
	 , CAST(mf.size as bigint)  * 8192 / 1024 / 1024  as 'size_inMB'
FROM   sys.databases db
join   sys.master_files mf
ON     db.database_id = mf.database_id
--  end VIEW]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[Servername]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[Servicename]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[DatabaseName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[name]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[recovery_model_desc]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[recovery_model_desc]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[database_id]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[database_id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[type_desc]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files].[type_desc]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[size_inPages]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files].[size]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_FileSize].[size_inMB]" />
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[database_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files].[database_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[recovery_model_desc]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files].[type_desc]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files].[size]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[master_files].[size]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="450" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE VIEW [dbo].[vw_Database_FileSize]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[dbo].[vw_Database_last_Backuptime]">
			<Property Name="QueryScript">
				<Value><![CDATA[
SELECT @@SERVERNAME   as 'Servername'
     , db.name        as 'DatabaseName'
	 , db.recovery_model_desc  --
	 , db.database_id
	 , bs.type                    as 'backup_type'
	 , MAX(bs.backup_finish_date) as 'last_db_backup_date'  
FROM   sys.databases db
left   join
       msdb.dbo.backupset bs
ON     db.name                = bs.database_name  collate Latin1_General_CI_AS
  and  db.recovery_model_desc = bs.recovery_model collate Latin1_General_CI_AS
GROUP  by db.name
     , db.recovery_model_desc
	 , db.database_id
	 , bs.type
--  end VIEW]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_last_Backuptime].[Servername]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_last_Backuptime].[DatabaseName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[name]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_last_Backuptime].[recovery_model_desc]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[recovery_model_desc]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_last_Backuptime].[database_id]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[database_id]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_last_Backuptime].[backup_type]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset].[type]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_last_Backuptime].[last_db_backup_date]" />
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset].[database_name]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[recovery_model_desc]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset].[recovery_model]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[name]" />
				</Entry>
				<Entry>
					<References ExternalSource="master.dacpac" Name="[master]|[sys].[databases].[database_id]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset].[type]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset].[backup_finish_date]" />
				</Entry>
				<Entry>
					<References ExternalSource="msdb.dacpac" Name="[msdb]|[dbo].[backupset].[type]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="617" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE VIEW [dbo].[vw_Database_last_Backuptime] &#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[dbo].[vw_Database_LoginUser_Mapping]">
			<Property Name="QueryScript">
				<Value><![CDATA[
SELECT distinct
       create_date
     , Servername
	 , Servicename
	 , Login_name
	 , Login_type
	 , Login_sid
	 , DatabaseName
	 , User_name
	 , User_type
	 , User_sid
FROM   dbo.Database_LoginUser_Mapping
WHERE  User_name not in ('guest', 'INFORMATION_SCHEMA', 'public', 'sys')
--  end VIEW]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[create_date]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[create_date]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[Servername]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[Servername]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[Servicename]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[Servicename]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[Login_name]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[Login_name]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[Login_type]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[Login_type]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[Login_sid]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[Login_sid]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[DatabaseName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[DatabaseName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[User_name]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[User_name]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[User_type]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[User_type]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[dbo].[vw_Database_LoginUser_Mapping].[User_sid]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[dbo].[Database_LoginUser_Mapping].[User_sid]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[create_date]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[Servername]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[Servicename]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[Login_name]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[Login_type]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[Login_sid]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[DatabaseName]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[User_name]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[User_type]" />
				</Entry>
				<Entry>
					<References Name="[dbo].[Database_LoginUser_Mapping].[User_sid]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="8" />
				<Property Name="Length" Value="366" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="----&#xD;&#xA;&#xD;&#xA;CREATE VIEW dbo.vw_Database_LoginUser_Mapping&#xD;&#xA;AS" />
			</Annotation>
		</Element>
	</Model>
</DataSchemaModel>